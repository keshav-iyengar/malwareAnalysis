package Mohiuddin;

import java.io.File;
import java.io.IOException;
import java.security.NoSuchAlgorithmException;
import org.jsoup.Jsoup;
import org.jsoup.nodes.Document;
import org.jsoup.nodes.Element;
import org.jsoup.select.Elements;


/*
 * @author mahmed27
 */
 
public class HybridAnalysisParser {
	
	//constructor 
	/*	
	public HybridAnalysisParser() {
		
		int i;
		
	}*/
	
    private String searchUrlEnd = "?environmentId=100";
    private String hybridAnalysisSearchURL = "https://www.hybrid-analysis.com/sample/";
    
    
    
    public boolean parseAnalysisDetails(File file, File outFilePath) throws NoSuchAlgorithmException, IOException {
        
    	//if(outFilePath == null) return false;
    	
    	//Calculate the hash of malware file
    	//then append the string to the hybridanalysis URL
        String sha256Hash = URLRepository.getSHA256OfAFile(file);
        String md5Hash = URLRepository.getMD5OfAFile(file);
        String url = this.hybridAnalysisSearchURL + sha256Hash;
        
        
        
        //this is for the html file of hybridanalysis.com/hash
        Document htmlDocument = null;
        try{
        	//connect to URL specified above
            htmlDocument = Jsoup.connect(url).timeout(10*1000).get();
        } catch(org.jsoup.HttpStatusException | java.net.UnknownHostException e){
            //e.printStackTrace();
            return false;
        }
        
        
        //Parsing for sample signatures
        Elements sampleSignatures = htmlDocument.select("section#sample-signatures");
        
        if(sampleSignatures != null && sampleSignatures.size() > 0) {

          //URLRepository.appendToFile(md5Hash + "," + sha256Hash + "," + url + "\n", outFilePath);
            return true;
            
            
        } else {
//            System.out.println("Result not found");
            return false;
        }
    }
    
    public void creteStatsBetweenVirussignAndhybridAnalysis() {
        
    }
}